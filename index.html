<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live In-Store Navigation</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f7f7f7; }
header { background:#007BFF; color:white; padding:20px; text-align:center; }
main { display:flex; flex-wrap: wrap; padding:20px; }
#mapContainer { flex:2; min-width:400px; height:500px; border:2px solid #ccc; margin-right:20px; position:relative; background:#eaeaea; overflow:hidden; }
svg { width:100%; height:100%; }
.store, .facility { cursor:pointer; }
.store rect { fill:#007BFF; }
.facility rect { fill:orange; }
.path { fill:none; stroke:#888; stroke-width:10; stroke-linecap:round; }
#person { position:absolute; width:20px; height:20px; background:red; border-radius:50%; top:0; left:0; transform:translate(-10px,-10px); z-index:100; }
#controls { flex:1; min-width:250px; }
h2 { color:#333; margin-top:0; }
select, button { width:100%; padding:8px; margin:5px 0; font-size:16px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:5px; text-align:left; }
th { background:#007BFF; color:white; }
</style>
</head>
<body>
<header>
  <h1>Live In-Store Navigation</h1>
</header>
<main>
<div id="mapContainer">
<svg id="mallMap">
  <!-- Corridor path -->
  <path id="corridorPath" class="path" d="50,50 L50,200 L200,200 L200,50 L350,50 L350,200" />

  <!-- Stores -->
  <g class="store" data-store="Grocery">
    <rect x="30" y="30" width="40" height="40"/>
    <text x="50" y="55" font-size="12" fill="white" text-anchor="middle">Grocery</text>
  </g>
  <g class="store" data-store="Clothing">
    <rect x="180" y="30" width="40" height="40"/>
    <text x="200" y="55" font-size="12" fill="white" text-anchor="middle">Clothing</text>
  </g>
  <g class="store" data-store="Electronics">
    <rect x="30" y="180" width="40" height="40"/>
    <text x="50" y="205" font-size="12" fill="white" text-anchor="middle">Electronics</text>
  </g>
  <g class="store" data-store="Movies">
    <rect x="180" y="180" width="40" height="40"/>
    <text x="200" y="205" font-size="12" fill="white" text-anchor="middle">Movies</text>
  </g>
</svg>
<div id="person"></div>
</div>

<div id="controls">
<h2>Select Item</h2>
<select id="itemSelect">
  <option value="">--Select Item--</option>
</select>
<button onclick="goToItem()">Go to Item</button>

<h2>Item List & Rates</h2>
<table id="itemsTable">
<thead><tr><th>Item</th><th>Rate</th></tr></thead>
<tbody><tr><td colspan="2">Select a store or item</td></tr></tbody>
</table>
</div>
</main>

<script>
// Store items
const storeItems = {
"Grocery":[{name:"Rice",rate:"$50/kg"}, {name:"Milk",rate:"$1/litre"}],
"Clothing":[{name:"Shirt",rate:"$20"}, {name:"Jacket",rate:"$60"}],
"Electronics":[{name:"Laptop",rate:"$800"}, {name:"Smartphone",rate:"$500"}],
"Movies":[{name:"DVDs",rate:"$10"}, {name:"Blu-ray",rate:"$15"}]
};

// Item -> store map
let itemToStore = {};
for(let store in storeItems){
  storeItems[store].forEach(item=> itemToStore[item.name] = store);
}

// Populate item select
const itemSelect = document.getElementById('itemSelect');
for(let item in itemToStore){
  const option = document.createElement('option');
  option.value = item;
  option.textContent = item;
  itemSelect.appendChild(option);
}

// Show items in table
const itemsTableBody = document.querySelector('#itemsTable tbody');
function showItems(storeName){
  const items = storeItems[storeName] || [];
  if(items.length===0){
    itemsTableBody.innerHTML='<tr><td colspan="2">No items available</td></tr>';
  } else {
    itemsTableBody.innerHTML = items.map(i=>`<tr><td>${i.name}</td><td>${i.rate}</td></tr>`).join('');
  }
}

// Animate person along SVG path
const person = document.getElementById('person');
const path = document.getElementById('corridorPath');
const pathLength = path.getTotalLength();

function movePersonAlongPath(storeName){
  const target = document.querySelector('[data-store="'+storeName+'"] rect');
  if(!target) return;

  // Find closest point on path to target
  const mapRect = document.getElementById('mallMap').getBoundingClientRect();
  const targetRect = target.getBoundingClientRect();
  const targetX = targetRect.left - mapRect.left + targetRect.width/2;
  const targetY = targetRect.top - mapRect.top + targetRect.height/2;

  let closestPoint = 0;
  let minDist = Infinity;
  for(let i=0;i<=pathLength;i+=1){
    const point = path.getPointAtLength(i);
    const dx = point.x - targetX;
    const dy = point.y - targetY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < minDist){
      minDist = dist;
      closestPoint = i;
    }
  }

  // Animate along path
  let progress = 0;
  function animate(){
    if(progress > closestPoint) return;
    const pos = path.getPointAtLength(progress);
    person.style.left = pos.x + 'px';
    person.style.top = pos.y + 'px';
    progress += 2; // speed
    requestAnimationFrame(animate);
  }
  animate();
  showItems(storeName);
}

// Go to selected item
function goToItem(){
  const item = itemSelect.value;
  if(!item) return alert("Select an item");
  const store = itemToStore[item];
  movePersonAlongPath(store);
}

// Click store to move
document.querySelectorAll('.store').forEach(el=>{
  el.addEventListener('click', ()=> movePersonAlongPath(el.dataset.store));
});
</script>
</body>
</html>
